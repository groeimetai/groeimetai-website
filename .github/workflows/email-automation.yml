name: Email Automation

on:
  schedule:
    # Run every hour to process scheduled emails
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  process-scheduled-emails:
    runs-on: ubuntu-latest

    steps:
      - name: Process Scheduled Emails
        run: |
          echo "Processing scheduled emails..."

          RESPONSE=$(curl -s -w "HTTPSTATUS:%{http_code}" \
            -X GET "${{ secrets.NEXT_PUBLIC_APP_URL }}/api/email/simple-followup")

          HTTP_BODY=$(echo $RESPONSE | sed -E 's/HTTPSTATUS\:[0-9]{3}$//')
          HTTP_STATUS=$(echo $RESPONSE | tr -d '\n' | sed -E 's/.*HTTPSTATUS:([0-9]{3})$/\1/')

          echo "Response Status: $HTTP_STATUS"

          if [ $HTTP_STATUS -eq 200 ]; then
            echo "Email processing completed successfully"
          else
            echo "Email processing failed with status: $HTTP_STATUS"
            echo "Response: $HTTP_BODY"
          fi
